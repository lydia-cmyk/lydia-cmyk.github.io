<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>POMODORO+ Â· ì§‘ì¤‘ íƒ€ì´ë¨¸ & ê³µë¶€ ê¸°ë¡</title>
  <meta name="description" content="ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸ì™€ í•™ìŠµ ë…¸í•˜ìš°. ìš°ì¸¡ íŒ¨ë„ì—ì„œ ë°”ë¡œ ê¸€ ì—´ëŒ + ìœ ë¦¬ì§ˆê°(ë¸”ëŸ¬) ë°°ê²½ ìœ ì§€." />
  <style>
    :root{ --bg:#0a0c12; --panel:#10131b; --panel-2:#151a24; --text:#edf2f7; --muted:#9aa0a6; --acc:#ff4d4f; --ring:#2a2f3a; --glow1:0 0 32px rgba(255,77,79,.22),0 0 8px rgba(255,77,79,.35); --glow2:0 0 36px rgba(138,180,248,.18), inset 0 0 0 1px rgba(255,255,255,.02); --prose:#cfd6e4 }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Roboto,Noto Sans KR,Helvetica,Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;font-variant-numeric:tabular-nums}
    .container{max-width:1080px;margin:0 auto;padding:28px}
    header.site{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{display:grid;place-items:center;width:42px;height:42px;border-radius:12px;background: radial-gradient(120% 120% at 30% 20%, #ff725e, #c92028 70%);box-shadow:var(--glow1)}
    .logo span{filter:drop-shadow(0 2px 2px rgba(0,0,0,.35))}
    .wordmark{font-weight:900;letter-spacing:.8px;font-size:20px;background:linear-gradient(90deg,#fff,#cbd5e1);-webkit-background-clip:text;background-clip:text;color:transparent}
    nav a{margin-left:16px;color:var(--text);text-decoration:none;font-weight:700;opacity:.9}
    nav a:hover{text-decoration:underline;text-underline-offset:3px}
    main{margin-top:22px}
    .row{display:flex;gap:18px;flex-wrap:wrap}

    /* ---- Glass + blurred city background (ğŸ”’ ìœ ì§€) ---- */
    body::before{
      content:""; position:fixed; inset:0;
      background:url('assets/bg-city.jpg?v=3') center/cover no-repeat;
      filter:blur(16px) saturate(120%) brightness(1.12);
      transform:scale(1.06); z-index:-2;
    }
    body::after{
      content:""; position:fixed; inset:0;
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(255,77,79,.06), transparent 60%),
        radial-gradient(900px 500px at 110% 10%, rgba(138,180,248,.05), transparent 60%),
        linear-gradient(180deg, rgba(8,10,16,.44), rgba(8,10,16,.56) 30%, rgba(8,10,16,.64));
      z-index:-1;
    }

    /* glass card */
    .card{ background:rgba(16,20,28,.42); border:1px solid rgba(255,255,255,.08);
           border-radius:20px; padding:18px; box-shadow:0 12px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
           -webkit-backdrop-filter:blur(18px) saturate(140%); backdrop-filter:blur(18px) saturate(140%); }
    /* glass header bar */
    header.site{ background:rgba(16,20,28,.38); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:10px 14px;
                 -webkit-backdrop-filter:blur(18px) saturate(140%); backdrop-filter:blur(18px) saturate(140%);
                 box-shadow:0 10px 36px rgba(0,0,0,.52), 0 2px 8px rgba(0,0,0,.25); }
    .card:hover{ transform: translateY(-2px); transition: transform .18s ease, box-shadow .18s ease; }

    /* ===== Timer ===== */
    .timer-card{flex:1 1 360px;display:grid;justify-items:center;text-align:center}
    .ring{position:relative;width:340px;height:340px;filter:drop-shadow(0 14px 30px rgba(255,77,79,.18))}
    .ring svg{transform:rotate(-90deg)}
    .time{position:absolute;inset:0}
    .mmss{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:64px;font-weight:900;letter-spacing:1px;text-shadow:0 2px 10px rgba(0,0,0,.35);line-height:1}
    .mode{position:absolute;top:65%;left:50%;transform:translateX(-50%);font-size:13px;color:#cbd5e1;letter-spacing:.4px}
    .controls{display:flex;gap:8px;justify-content:center;margin-top:10px}
    button{background:rgba(26,31,43,.6);color:var(--text);border:1px solid rgba(255,255,255,.10);padding:12px 16px;border-radius:16px;cursor:pointer;font-weight:800}
    .primary{background:linear-gradient(180deg,#ff5a5c,#ff3b3d);border-color:#b3262e;color:#fff}
    .ghost{background:transparent}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;background: rgba(255,255,255,.06);
          backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); padding:6px; border-radius:18px;
          border:1px solid rgba(255,255,255,.08) }
    .tab{padding:9px 14px;border-radius:12px;background:transparent;border:none;color:var(--text);cursor:pointer}
    .tab[aria-pressed="true"],.tab[aria-selected="true"]{background: rgba(255,255,255,.14); color:#fff}

    /* ===== Inputs ===== */
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    input[type="text"],input[type="number"],input[type="range"]{width:100%;background:#0e1220;color:#fff;border:1px solid #2a3140;border-radius:10px;padding:10px}
    label{font-size:12px;color:#b2bac7;display:block;margin-bottom:6px}

    /* ===== Blog cards (album) ===== */
    .blog-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:16px}
    .post-card{display:block;overflow:hidden;border-radius:20px;border:1px solid rgba(255,255,255,.10);background:rgba(16,20,28,.42);box-shadow: 0 24px 60px rgba(0,0,0,.52), 0 8px 20px rgba(0,0,0,.30), inset 0 1px 0 rgba(255,255,255,.05)}
    .post-thumb{aspect-ratio:16/9;background-size:cover;background-position:center;background-image:linear-gradient(135deg,#1e2634,#131a27)}
    .post-meta{padding:12px 12px 14px}.post-title{font-weight:900;color:var(--text);font-size:15px;line-height:1.35;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .post-date{font-size:12px;color:#9aa0a6}

    /* ===== Article (inline on right) ===== */
    #blog .blog-article{ margin-top:8px }
    #blog .blog-article .meta{ color:#9aa0a6; font-size:13px; margin:0 0 10px }
    #blog .blog-article .content{ color:#cfd6e4; line-height:1.75 }
    #blog .blog-article h1{ font-size:22px; margin:0 0 6px; font-weight:900 }
    #blog .blog-article img{ display:block; max-width:100%; width:100%; height:auto; border-radius:12px; margin:10px 0 }

    /* ===== Layout: right sidebar sticky ===== */
    @media (min-width:1120px){
      main{ display:grid; grid-template-columns:1fr 360px; gap:18px; align-items:start }
      #homeFlag, main > .row, #postView{ grid-column:1 }
      #blog{ grid-column:2; grid-row:1 / span 3; position:sticky; top:84px; margin-top:0 !important; align-self:start }
      #blog .blog-grid{ grid-template-columns:1fr }
    }

    /* Footer & misc */
    .footer{margin-top:28px;display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;color:#9aa0a6}
    .pill{padding:6px 10px;background:var(--panel-2);border:1px solid var(--ring);border-radius:999px;font-size:12px}
    .link{color:#8ab4f8;text-underline-offset:2px}
  </style>
</head>
<body>
<div class="container">
  <header class="site">
    <div class="brand"><div class="logo"><span>ğŸ…</span></div><div class="wordmark">POMODORO+</div></div>
    <nav><a href="#" id="navHome">í™ˆ</a><a href="#blog" id="navBlog">ë¸”ë¡œê·¸</a></nav>
  </header>

  <main>
    <section id="homeFlag" class="row">
      <section class="card timer-card" aria-label="íƒ€ì´ë¨¸">
        <div id="modeBtns" class="tabs" role="tablist" aria-label="ëª¨ë“œ">
          <button class="tab" data-mode="focus" aria-selected="true">ì§‘ì¤‘</button>
          <button class="tab" data-mode="short">ì§§ì€ íœ´ì‹</button>
          <button class="tab" data-mode="long">ê¸´ íœ´ì‹</button>
        </div>
        <div class="ring" aria-live="polite">
          <svg width="100%" height="100%" viewBox="0 0 300 300" aria-hidden="true">
            <defs><linearGradient id="grad" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ff8a80"/><stop offset="100%" stop-color="#ff4d4f"/></linearGradient></defs>
            <circle cx="150" cy="150" r="140" fill="none" stroke="var(--ring)" stroke-width="16" />
            <circle id="ring" cx="150" cy="150" r="140" fill="none" stroke="url(#grad)" stroke-width="16" stroke-linecap="round" stroke-dasharray="0" stroke-dashoffset="0"/>
          </svg>
          <div class="time"><div class="mmss" id="time">25:00</div><div class="mode" id="mode">ì§‘ì¤‘</div></div>
        </div>
        <div class="controls">
          <button id="startBtn" class="primary">ì‹œì‘</button>
          <button id="pauseBtn" class="ghost" hidden>ì¼ì‹œì •ì§€</button>
          <button id="resetBtn" class="ghost">ë¦¬ì…‹</button>
          <button id="nextBtn" class="ghost">ë‹¤ìŒ â–¶ï¸</button>
        </div>
        <div class="muted small" style="margin-top:8px">ì˜¤ëŠ˜ ì™„ë£Œí•œ ì§‘ì¤‘: <span id="completed">0</span>íšŒ</div>
      </section>

      <section class="card tasks" aria-label="ì‘ì—…">
        <h3>ì‘ì—…</h3>
        <div class="grid-2" style="margin-bottom:8px">
          <div><label for="taskTitle">ì‘ì—…ëª…</label><input id="taskTitle" type="text" placeholder="ì˜ˆ: ìˆ˜í•™ nì œ 4ë‹¨ì› ë³µìŠµ" /></div>
          <div><label for="taskEst">ì˜ˆìƒ ë½€ëª¨ ìˆ˜</label><input id="taskEst" type="number" min="1" value="1" /></div>
        </div>
        <button id="addTaskBtn">ì‘ì—… ì¶”ê°€</button>
        <div id="taskList" style="margin-top:12px; display:grid; gap:8px"></div>
      </section>
    </section>

    <section class="row" style="margin-top:16px">
      <section class="card" style="flex:1 1 380px" aria-label="ì„¤ì •">
        <h3>ì„¤ì •</h3>
        <div class="grid-2">
          <div><label for="focusMin">ì§‘ì¤‘ (ë¶„)</label><input id="focusMin" type="number" min="1" /></div>
          <div><label for="shortMin">ì§§ì€ íœ´ì‹ (ë¶„)</label><input id="shortMin" type="number" min="1" /></div>
          <div><label for="longMin">ê¸´ íœ´ì‹ (ë¶„)</label><input id="longMin" type="number" min="1" /></div>
          <div><label for="longEvery">ê¸´ íœ´ì‹ ì£¼ê¸° (ì§‘ì¤‘ ëª‡ íšŒë§ˆë‹¤)</label><input id="longEvery" type="number" min="2" /></div>
          <div><label><input id="autoBreak" type="checkbox" /> íœ´ì‹ ìë™ ì‹œì‘</label></div>
          <div><label><input id="autoFocus" type="checkbox" /> ì§‘ì¤‘ ìë™ ì‹œì‘</label></div>
          <div><label><input id="sound" type="checkbox" /> ì•Œë¦¼ìŒ</label></div>
          <div><label for="volume">ë³¼ë¥¨</label><input id="volume" type="range" min="0" max="1" step="0.01" /></div>
          <div><label><input id="notify" type="checkbox" /> ë°ìŠ¤í¬í†± ì•Œë¦¼</label></div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:12px">
          <button id="resetToday" type="button" class="ghost">ì˜¤ëŠ˜ ê¸°ë¡ ì´ˆê¸°í™”</button>
          <button id="resetAll" type="button" class="ghost" style="border-color:#b3262e;color:#ffb3b3">ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”</button>
        </div>
      </section>

      <section class="card" style="flex:1 1 380px" aria-label="í†µê³„/ê°€ì´ë“œ">
        <h3>ì˜¤ëŠ˜ì˜ ê¸°ë¡</h3>
        <div class="pill" style="display:inline-flex; gap:8px; align-items:center">â±ï¸ <span id="statsToday">0íšŒ Â· 0ë¶„</span> Â· ğŸ”¥ <span id="streak">0ì¼ ì—°ì†</span></div>
        <details style="margin-top:14px">
          <summary>ë½€ëª¨ë„ë¡œ íŒ (ê°„ë‹¨ ìš”ì•½)</summary>
          <ul>
            <li>25ë¶„ ì§‘ì¤‘ + 5ë¶„ íœ´ì‹(4íšŒ í›„ 15ë¶„ íœ´ì‹)ì„ ê¸°ë³¸ìœ¼ë¡œ ì‹œì‘í•˜ê³ , ë³¸ì¸ì—ê²Œ ë§ê²Œ ì¡°ì •í•˜ì„¸ìš”.</li>
            <li>ê° ì„¸ì…˜ì—ëŠ” <b>í•˜ë‚˜ì˜ êµ¬ì²´ì ì¸ ì‘ì—…</b>ë§Œ ì„ íƒí•˜ì„¸ìš”. ì‹œì‘ ì „ì— ëª©í‘œë¥¼ í•œ ì¤„ë¡œ ê¸°ë¡í•´ ë³´ì„¸ìš”.</li>
            <li>íœ´ì‹ ì‹œê°„ì—ëŠ” ë‡Œë¥¼ ì‰¬ê²Œ í•˜ì„¸ìš”. íœ´ëŒ€ì „í™”ëŠ” ë©€ë¦¬ ë‘ê³ , ë¬¼ì„ ë§ˆì‹œê±°ë‚˜ ê°€ë³ê²Œ ìŠ¤íŠ¸ë ˆì¹­í•´ ë³´ì„¸ìš”.</li>
            <li>í•˜ë£¨ê°€ ëë‚˜ë©´ ì˜¤ëŠ˜ì˜ ì„¸ì…˜/ì‹œê°„ì„ í™•ì¸í•˜ê³ , ë‚´ì¼ì˜ ì‘ì—…ì„ ë¯¸ë¦¬ ë“±ë¡í•´ ë‘ì„¸ìš”.</li>
          </ul>
          <p class="notice">â€» ê¸°ë¡ì€ ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤(localStorage). ë‹¤ë¥¸ ê¸°ê¸°ì™€ëŠ” ë™ê¸°í™”ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        </details>
      </section>
    </section>

    <!-- Right sidebar blog block -->
    <section class="card" aria-label="ìµœê·¼ ê²Œì‹œê¸€" id="blog" style="margin-top:16px">
      <h3>ìµœê·¼ ê¸€</h3>
      <!-- ëª©ë¡ -->
      <div id="blogList">
        <div class="blog-grid" id="blogGrid" aria-live="polite"></div>
        <div style="margin-top:10px"><a href="#" class="link">ëª¨ë“  ê¸€ ë³´ê¸° â†’</a></div>
      </div>
      <!-- ê¸€ ë³´ê¸° (ìš°ì¸¡ íŒ¨ë„ì—ì„œ ì¦‰ì‹œ í‘œì‹œ) -->
      <div id="blogArticleWrap" class="blog-article" hidden>
        <div class="meta"><a href="#" id="blogBack" class="link">â† ëª©ë¡ìœ¼ë¡œ</a></div>
        <article class="content" id="blogArticle"></article>
      </div>
    </section>

    <!-- (í˜¸í™˜ìš©) ë‹¨ì¼ ë³¸ë¬¸ ì¹´ë“œ: í˜„ì¬ëŠ” ì‚¬ìš© ì•ˆ í•¨ -->
    <section id="postView" class="card article" hidden>
      <div class="meta"><a href="#" id="backHome" class="link">â† ëª©ë¡ìœ¼ë¡œ</a></div>
      <article class="content" id="article"></article>
    </section>
  </main>

  <div class="footer">
    <div class="small">Â© POMODORO+ Â· í•™ìŠµ ìƒì‚°ì„± ë¸”ë¡œê·¸ & íƒ€ì´ë¨¸</div>
    <div class="small">ìº”ë²„ìŠ¤ ì „ìš© í”„ë¦¬ë·° â€” ì‹¤ì œ ë°°í¬ì—ì„  /posts.jsonì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</div>
  </div>
</div>

<!-- âœ… ìº”ë²„ìŠ¤/ë¡œì»¬ì—ì„œë„ ê¸€ì´ ë³´ì´ê²Œ í•˜ë ¤ë©´: ì—¬ê¸° JSON ë°°ì—´ì— posts.json ë‚´ìš©ì„ ë¶™ì—¬ë„£ê¸° -->
<script id="postsInline" type="application/json">[
  
]</script>

<script>
  const $=(s)=>document.querySelector(s); const $$=(s)=>document.querySelectorAll(s);
  const store={ get(k,d){try{return JSON.parse(localStorage.getItem(k))??d}catch(_){return d}}, set(k,v){localStorage.setItem(k,JSON.stringify(v))} };
  const fmt2=n=>String(n).padStart(2,'0'); const todayKey=()=>new Date().toISOString().slice(0,10);

  let audioCtx=null,audioUnlocked=false; function ensureAudio(){try{if(!audioCtx){audioCtx=new (window.AudioContext||window.webkitAudioContext)()} if(audioCtx.state==='suspended'){ audioCtx.resume() } audioUnlocked=true}catch(e){console.warn('Audio init failed',e)}}
  function playChime(kind='done'){ if(!state.sound||!audioCtx||!audioUnlocked) return; const vol=Math.max(0,Math.min(1,state.volume||0.4)); function tone(f,d,s){const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type='sine';o.frequency.value=f;o.connect(g);g.connect(audioCtx.destination);const t0=audioCtx.currentTime+(s||0);g.gain.setValueAtTime(0,t0);g.gain.linearRampToValueAtTime(vol*0.35,t0+0.02);g.gain.exponentialRampToValueAtTime(0.0001,t0+d);o.start(t0);o.stop(t0+d+0.05)} if(kind==='focusEnd'){tone(880,0.12,0);tone(1175,0.12,0.15)} else {tone(523.25,0.10,0);tone(659.25,0.10,0.12);tone(783.99,0.12,0.24)} }
  function notifyUser(t,b){ if(!state.notify) return; try{ if('Notification' in window && Notification.permission==='granted'){ new Notification(t,{body:b}) } }catch(e){}

  const defaultState={mode:'focus',durations:{focus:25,short:5,long:15},longInterval:4,completedFocus:0,remainingMs:25*60*1000,isRunning:false,autoStartBreaks:true,autoStartFocus:false,sound:true,volume:0.4,notify:true,selectedTaskId:null};
  let state=Object.assign({},defaultState,store.get('pomo:state',{})); let tasks=store.get('pomo:tasks',[]); let stats=store.get('pomo:stats',{}); let endAt=null,rafId=null;
  function durationMs(m){return (state.durations[m]||25)*60*1000} function persist(){store.set('pomo:state',state)}
  function addStat(k,d){const t=todayKey(),b=stats[t]||{sessions:0,focusMs:0}; if(k==='sessions') b.sessions=(b.sessions|0)+d; else b[k]=(b[k]||0)+d; stats[t]=b; store.set('pomo:stats',stats); renderStats() }
  const getTodaySessions=()=> (stats[todayKey()]?.sessions|0);
  function resetTodayStats(){ const k=todayKey(); stats[k]={sessions:0,focusMs:0}; store.set('pomo:stats',stats) }
  function resetAllData(){ localStorage.removeItem('pomo:state'); localStorage.removeItem('pomo:tasks'); localStorage.removeItem('pomo:stats'); state=Object.assign({},defaultState); tasks=[]; stats={}; persist() }

  function setMode(m){ state.mode=m; state.remainingMs=durationMs(m); state.isRunning=false; endAt=null; clearInterval(rafId); persist(); updateUI() }
  function start(){ if(state.isRunning) return; state.isRunning=true; endAt=Date.now()+state.remainingMs; tick(); rafId=setInterval(tick,200); persist() }
  function pause(){ if(!state.isRunning) return; state.isRunning=false; state.remainingMs=Math.max(0,endAt-Date.now()); clearInterval(rafId); rafId=null; persist(); updateUI() }
  function reset(){ state.isRunning=false; state.remainingMs=durationMs(state.mode); clearInterval(rafId); rafId=null; endAt=null; persist(); updateUI() }
  function completeSession(){ if(state.mode==='focus'){ playChime('focusEnd'); notifyUser('ì§‘ì¤‘ ì¢…ë£Œ','íœ´ì‹ ì‹œê°„ì„ ì‹œì‘í•©ë‹ˆë‹¤.'); state.completedFocus++; addStat('sessions',1); addStat('focusMs',durationMs('focus')); if(state.selectedTaskId){ const t=tasks.find(t=>t.id===state.selectedTaskId); if(t){ t.done=Math.min((t.done||0)+1, t.est||99); saveTasks(); renderTasks() } } const nextIsLong=(state.completedFocus%state.longInterval)===0; setMode(nextIsLong?'long':'short'); if(state.autoStartBreaks) start(); } else { playChime('breakEnd'); notifyUser('íœ´ì‹ ì¢…ë£Œ','ë‹¤ìŒ ì§‘ì¤‘ì„ ì‹œì‘í•©ë‹ˆë‹¤.'); setMode('focus'); if(state.autoStartFocus) start() } persist() }
  function next(){ completeSession() }
  function tick(){ const left=endAt-Date.now(); if(left<=0){ state.remainingMs=0; updateUI(); clearInterval(rafId); rafId=null; completeSession(); return } state.remainingMs=left; updateUI() }

  function saveTasks(){ store.set('pomo:tasks',tasks) } function addTask(t,e){ const n={id:crypto.randomUUID(),title:t.trim(),est:Math.max(1,e|0),done:0}; if(!n.title) return; tasks.unshift(n); saveTasks(); renderTasks(); if(!state.selectedTaskId){ state.selectedTaskId=n.id; persist() } }
  function delTask(id){ tasks=tasks.filter(t=>t.id!==id); saveTasks(); if(state.selectedTaskId===id){ state.selectedTaskId=tasks[0]?.id||null; persist() } renderTasks() }
  function selTask(id){ state.selectedTaskId=id; persist(); renderTasks() }

  function mmss(ms){ const t=Math.ceil(ms/1000); const m=Math.floor(t/60); const s=t%60; return `${fmt2(m)}:${fmt2(s)}` }

  function updateUI(){ const total=durationMs(state.mode); const left=state.remainingMs; const pct=1-Math.max(0,Math.min(1,left/total)); const r=140,C=2*Math.PI*r,off=C*pct; const ring=$('#ring'); if(ring){ ring.setAttribute('stroke-dasharray',C); ring.setAttribute('stroke-dashoffset',off) } const timeEl=$('#time'); if(timeEl) timeEl.textContent=mmss(left); const modeEl=$('#mode'); if(modeEl) modeEl.textContent= state.mode==='focus'?'ì§‘ì¤‘':(state.mode==='short'?'ì§§ì€ íœ´ì‹':'ê¸´ íœ´ì‹'); document.title = `${mmss(left)} Â· ${(modeEl?modeEl.textContent:'ëª¨ë“œ')} â€” POMODORO+`; $$('#modeBtns button').forEach(b=> b.setAttribute('aria-pressed', b.dataset.mode===state.mode)); const sb=$('#startBtn'),pb=$('#pauseBtn'); if(sb&&pb){ sb.hidden=state.isRunning; pb.hidden=!state.isRunning } const fm=$('#focusMin'),sm=$('#shortMin'),lm=$('#longMin'),le=$('#longEvery'); if(fm) fm.value=state.durations.focus; if(sm) sm.value=state.durations.short; if(lm) lm.value=state.durations.long; if(le) le.value=state.longInterval; const ab=$('#autoBreak'),af=$('#autoFocus'),snd=$('#sound'),vol=$('#volume'),nt=$('#notify'); if(ab) ab.checked=state.autoStartBreaks; if(af) af.checked=state.autoStartFocus; if(snd) snd.checked=state.sound; if(vol) vol.value=state.volume; if(nt) nt.checked=state.notify; const comp=$('#completed'); if(comp) comp.textContent=getTodaySessions() }

  function renderTasks(){ const wrap=$('#taskList'); if(!wrap) return; wrap.innerHTML=''; if(tasks.length===0){ wrap.innerHTML='<div class="notice">ì•„ì§ ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì‘ì—…ì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”.</div>'; return } tasks.forEach(t=>{ const item=document.createElement('div'); item.className='task-item'; item.setAttribute('aria-current', state.selectedTaskId===t.id); item.innerHTML=`<input type="radio" name="sel" ${state.selectedTaskId===t.id?'checked':''} aria-label="í˜„ì¬ ì‘ì—… ì„ íƒ"/><div class="task-title">${escapeHtml(t.title)} <span class="muted small">(${t.done||0}/${t.est})</span></div><div class="task-actions"><button class="ok" title="ì™„ë£Œ 1 ì¦ê°€">+1</button><button class="ghost" title="ìˆ˜ì •">í¸ì§‘</button><button class="danger" title="ì‚­ì œ">ì‚­ì œ</button></div>`; const [radio,,actions]=item.children; radio.addEventListener('change',()=>selTask(t.id)); actions.children[0].addEventListener('click',()=>{ t.done=(t.done||0)+1; saveTasks(); renderTasks() }); actions.children[1].addEventListener('click',()=>{ const title=prompt('ì‘ì—…ëª…', t.title); if(title===null) return; const est=parseInt(prompt('ì˜ˆìƒ ë½€ëª¨ ìˆ˜', t.est),10); if(!title.trim()) return; t.title=title.trim(); t.est=isNaN(est)?t.est:Math.max(1,est); saveTasks(); renderTasks() }); actions.children[2].addEventListener('click',()=>{ if(confirm('ì‚­ì œí• ê¹Œ?')) delTask(t.id) }); item.addEventListener('click',e=>{ if(e.target.tagName!=='BUTTON'&&e.target.tagName!=='INPUT') selTask(t.id) }); wrap.appendChild(item) }) }

  function renderStats(){ const k=todayKey(); const s=stats[k]||{sessions:0,focusMs:0}; const st=$('#statsToday'); if(st) st.textContent=`${s.sessions|0}íšŒ Â· ${((s.focusMs||0)/60000)|0}ë¶„`; let streak=0; const dates=Object.keys(stats).sort().reverse(); let cur=new Date(); for(const d of dates){ const y=cur.toISOString().slice(0,10); if(d===y && (stats[d]?.sessions||0)>0){ streak++; cur.setDate(cur.getDate()-1) } else break } const se=$('#streak'); if(se) se.textContent=`${streak}ì¼ ì—°ì†` }

  // ===== Blog loader + inline right sidebar viewer =====
  let POSTS=[]; function escapeHtml(s){ return String(s).replace(/[&<>"]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c])) }
  function md2html(md){ let h=md.replace(/^###\s+(.+)$/gm,'<h3>$1</h3>').replace(/^##\s+(.+)$/gm,'<h2>$1</h2>').replace(/^#\s+(.+)$/gm,'<h1>$1</h1>'); h=h.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>').replace(/\*(.+?)\*/g,'<em>$1</em>'); h=h.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,'<img src="$2" alt="$1" loading="lazy">'); h=h.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2">$1<\/a>'); h=h.replace(/(?:^|\n)-\s+(.+)(?=\n|$)/g,'\n<li>$1<\/li>'); h=h.replace(/(<li>.*<\/li>)/gs,'<ul>$1<\/ul>'); h=h.split(/\n{2,}/).map(x=>/^<h\d|<ul>|<li>|<img|<a/.test(x)?x:`<p>${x.trim()}<\/p>`).join('\n'); return h }

  async function loadPosts(){ const grid=$('#blogGrid'); if(!grid) return; POSTS=[];
    // 1) ìº”ë²„ìŠ¤/ë¡œì»¬: ë‚´ì¥ JSON ë¨¼ì € ì‹œë„
    try{ const blk=$('#postsInline'); const raw=blk?.textContent?.trim(); if(raw){ const arr=JSON.parse(raw); if(Array.isArray(arr)) POSTS=arr } }catch(e){ console.warn('postsInline parse error',e) }
    // 2) ë°°í¬ í™˜ê²½: /posts.json ê°€ì ¸ì˜¤ê¸°
    if(POSTS.length===0){ try{ const res=await fetch('/posts.json',{cache:'no-store'}); if(res.ok){ const arr=await res.json(); if(Array.isArray(arr)) POSTS=arr } }catch(_){ /* ignore */ } }
    // 3) ì—¬ì „íˆ ì—†ìœ¼ë©´ ìƒ˜í”Œ
    if(!Array.isArray(POSTS) || POSTS.length===0){ POSTS=[{slug:'start-pomodoro',title:'ë½€ëª¨ë„ë¡œ ì‹œì‘ ê°€ì´ë“œ: ì²« 7ì¼ ë¡œë“œë§µ',date:'2025-08-01',md:'# ì‹œì‘í•˜ê¸°\n\nê¸°ë³¸ ì‚¬ì´í´ **25/5** ë¥¼ ì¼ì£¼ì¼ë§Œ ì§€ì¼œë³´ì„¸ìš”.',thumb:''},{slug:'deep-work-setup',title:'ì§‘ì¤‘ í™˜ê²½ ì…‹ì—…: ì±…ìƒ ìœ„ 5ê°€ì§€ë§Œ ë‚¨ê²¨',date:'2025-08-02',md:'- ì¡ë™ì‚¬ë‹ˆ ì •ë¦¬\n- íƒ€ì´ë¨¸ ê³ ì •\n- ì˜ì/ì¡°ëª… ì ê²€',thumb:''}] }

    grid.innerHTML='';
    POSTS.slice(0,12).forEach(p=>{
      const card=document.createElement('a');
      card.href=`#p/${p.slug}`; // í•´ì‹œë¡œ ìƒíƒœë§Œ ìœ ì§€
      card.className='post-card';
      const styleThumb=p.thumb?` style="background-image:url('${p.thumb}')"`:'';
      card.innerHTML=`<div class="post-thumb"${styleThumb}></div><div class="post-meta"><div class="post-title">${escapeHtml(p.title||'ì œëª© ì—†ìŒ')}</div><div class="post-date">${p.date?escapeHtml(p.date):''}</div></div>`;
      // ìš°ì¸¡ íŒ¨ë„ì—ì„œ ë°”ë¡œ ì—´ê¸° (ìŠ¤í¬ë¡¤ ì´ë™ ì—†ìŒ)
      card.addEventListener('click', (e)=>{ e.preventDefault(); showSidebarPost(p.slug); location.hash = `#p/${p.slug}`; });
      grid.appendChild(card);
    });
  }

  // ì‚¬ì´ë“œë°” ë³´ê¸°/ëª©ë¡ í† ê¸€
  function showSidebarList(){ const list=$('#blogList'); const wrap=$('#blogArticleWrap'); if(list) list.hidden=false; if(wrap) wrap.hidden=true; }
  function showSidebarPost(slug){ const p=POSTS.find(x=>x.slug===slug); if(!p){ showSidebarList(); return } const list=$('#blogList'); const wrap=$('#blogArticleWrap'); const art=$('#blogArticle'); if(art){ const title=`<h1>${escapeHtml(p.title||'ì œëª© ì—†ìŒ')}</h1><div class="meta">${escapeHtml(p.date||'')}</div>`; let body=''; if(p.html) body=p.html; else if(p.md) body=md2html(p.md); else body='<p>ë³¸ë¬¸ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>'; art.innerHTML=title+body; } if(list) list.hidden=true; if(wrap) wrap.hidden=false; document.title=`${p.title} â€” POMODORO+`; }

  function router(){ const m=location.hash.match(/^#p\/(?<slug>[a-z0-9\-]+)$/i); if(m&&m.groups?.slug){ showSidebarPost(m.groups.slug) } else { showSidebarList() } }

  function bind(){
    $$('#modeBtns button').forEach(b=> b.addEventListener('click',()=> setMode(b.dataset.mode)));
    const on=(s,e,f)=>{const el=$(s); if(el) el.addEventListener(e,f)};
    on('#startBtn','click',()=>{ensureAudio(); start()}); on('#pauseBtn','click',()=>{ensureAudio(); pause()}); on('#resetBtn','click',()=>{ensureAudio(); reset()}); on('#nextBtn','click',next);
    on('#addTaskBtn','click',()=>{ const title=$('#taskTitle')?.value||''; const est=parseInt($('#taskEst')?.value||'1',10)||1; addTask(title,est); if($('#taskTitle')) $('#taskTitle').value=''; if($('#taskEst')) $('#taskEst').value=1; $('#taskTitle')?.focus() });
    on('#focusMin','change',e=>{ state.durations.focus=Math.max(1,e.target.value|0); if(state.mode==='focus') state.remainingMs=durationMs('focus'); persist(); updateUI() });
    on('#shortMin','change',e=>{ state.durations.short=Math.max(1,e.target.value|0); if(state.mode==='short') state.remainingMs=durationMs('short'); persist(); updateUI() });
    on('#longMin','change',e=>{ state.durations.long=Math.max(1,e.target.value|0); if(state.mode==='long') state.remainingMs=durationMs('long'); persist(); updateUI() });
    on('#longEvery','change',e=>{ state.longInterval=Math.max(2,e.target.value|0); persist() });
    on('#autoBreak','change',e=>{ state.autoStartBreaks=e.target.checked; persist() });
    on('#autoFocus','change',e=>{ state.autoStartFocus=e.target.checked; persist() });
    on('#sound','change',e=>{ state.sound=e.target.checked; persist() });
    on('#notify','change',e=>{ state.notify=e.target.checked; if(e.target.checked && Notification && Notification.permission!=='granted') Notification.requestPermission(); persist() });
    on('#volume','input',e=>{ state.volume=Number(e.target.value); persist() });

    // ë¸”ë¡œê·¸ ë‚´ ë’¤ë¡œê°€ê¸° (ìš°ì¸¡ íŒ¨ë„ ë‚´ë¶€)
    on('#blogBack','click', (e)=>{ e.preventDefault(); showSidebarList(); history.replaceState(null,'', location.pathname + location.search); });

    // ê¸€ë¡œë²Œ ë¼ìš°í„°
    window.addEventListener('hashchange',router);

    // ë„¤ë¹„
    on('#navBlog','click',(e)=>{ e.preventDefault(); location.hash=''; showSidebarList(); document.getElementById('blog')?.scrollIntoView({behavior:'smooth', block:'start'}); });
    on('#navHome','click',(e)=>{ e.preventDefault(); location.hash=''; showSidebarList(); window.scrollTo({top:0, behavior:'smooth'}); });

    window.addEventListener('pointerdown',()=>ensureAudio(),{once:true});
  }

  async function init(){ bind(); if(state.remainingMs>durationMs(state.mode)) state.remainingMs=durationMs(state.mode); updateUI(); renderTasks(); renderStats(); await loadPosts(); router() }
  document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
